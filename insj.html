<!-- index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskFlow Pro - Intelligent Task Management</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #ec4899;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #0f172a;
        --darker: #020617;
        --card: #1e293b;
        --card-hover: #334155;
        --text: #f8fafc;
        --text-muted: #94a3b8;
        --border: #334155;
        --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        --glow: 0 0 20px rgba(99, 102, 241, 0.5);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--darker);
        color: var(--text);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Animated Background */
      .bg-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .bg-animation::before {
        content: "";
        position: absolute;
        width: 150%;
        height: 150%;
        background:
          radial-gradient(
            circle at 20% 80%,
            rgba(120, 119, 198, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 119, 198, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 40%,
            rgba(99, 102, 241, 0.2) 0%,
            transparent 50%
          );
        animation: float 20s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translate(0, 0) rotate(0deg);
        }
        33% {
          transform: translate(30px, -30px) rotate(120deg);
        }
        66% {
          transform: translate(-20px, 20px) rotate(240deg);
        }
      }

      /* Glassmorphism Utilities */
      .glass {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .glass-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        transition: all 0.3s ease;
      }

      .glass-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow);
        border-color: rgba(99, 102, 241, 0.3);
      }

      /* Layout */
      .app-container {
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: 280px;
        background: var(--dark);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        position: fixed;
        height: 100vh;
        z-index: 100;
        transition: transform 0.3s ease;
      }

      .sidebar-header {
        padding: 24px;
        border-bottom: 1px solid var(--border);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 24px;
        font-weight: 700;
        background: var(--gradient-1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .logo i {
        font-size: 28px;
        -webkit-text-fill-color: initial;
        color: var(--primary);
      }

      .nav-menu {
        flex: 1;
        padding: 20px 12px;
        overflow-y: auto;
      }

      .nav-section {
        margin-bottom: 24px;
      }

      .nav-section-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--text-muted);
        padding: 0 16px;
        margin-bottom: 8px;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        margin: 4px 0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
        color: var(--text-muted);
        text-decoration: none;
        position: relative;
        overflow: hidden;
      }

      .nav-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 3px;
        background: var(--primary);
        transform: scaleY(0);
        transition: transform 0.2s;
      }

      .nav-item:hover,
      .nav-item.active {
        background: rgba(99, 102, 241, 0.1);
        color: var(--text);
      }

      .nav-item.active::before {
        transform: scaleY(1);
      }

      .nav-item i {
        width: 20px;
        text-align: center;
      }

      .badge {
        margin-left: auto;
        background: var(--primary);
        color: white;
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 20px;
        font-weight: 600;
      }

      .sidebar-footer {
        padding: 20px;
        border-top: 1px solid var(--border);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .user-profile:hover {
        background: var(--card);
      }

      .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--gradient-1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 16px;
      }

      .user-info {
        flex: 1;
      }

      .user-name {
        font-weight: 600;
        font-size: 14px;
      }

      .user-role {
        font-size: 12px;
        color: var(--text-muted);
        text-transform: capitalize;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 280px;
        padding: 32px;
        overflow-y: auto;
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
      }

      .page-title h1 {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 8px;
        background: linear-gradient(to right, #fff, #94a3b8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .page-title p {
        color: var(--text-muted);
      }

      .top-actions {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .search-box {
        position: relative;
      }

      .search-box input {
        background: var(--card);
        border: 1px solid var(--border);
        padding: 12px 16px 12px 44px;
        border-radius: 12px;
        color: var(--text);
        width: 300px;
        outline: none;
        transition: all 0.2s;
      }

      .search-box input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .search-box i {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
      }

      .btn {
        padding: 12px 24px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
        text-decoration: none;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
        box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.39);
      }

      .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--glow);
      }

      .btn-secondary {
        background: var(--card);
        color: var(--text);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--card-hover);
        border-color: var(--primary);
      }

      .btn-danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.2);
      }

      .btn-danger:hover {
        background: rgba(239, 68, 68, 0.2);
      }

      .btn-sm {
        padding: 8px 16px;
        font-size: 13px;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 24px;
        margin-bottom: 32px;
      }

      .stat-card {
        padding: 24px;
        position: relative;
        overflow: hidden;
      }

      .stat-card::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100%;
        background: linear-gradient(
          to right,
          transparent,
          rgba(255, 255, 255, 0.03)
        );
        pointer-events: none;
      }

      .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-bottom: 16px;
      }

      .stat-icon.purple {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
      }
      .stat-icon.pink {
        background: rgba(236, 72, 153, 0.1);
        color: var(--secondary);
      }
      .stat-icon.green {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }
      .stat-icon.orange {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning);
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 4px;
      }

      .stat-label {
        color: var(--text-muted);
        font-size: 14px;
      }

      .stat-change {
        font-size: 12px;
        margin-top: 8px;
        font-weight: 600;
      }

      .stat-change.positive {
        color: var(--success);
      }
      .stat-change.negative {
        color: var(--danger);
      }

      /* Content Grid */
      .content-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
      }

      /* Task Cards */
      .task-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .task-item {
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 16px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .task-item:hover {
        background: var(--card-hover);
        transform: translateX(4px);
      }

      .task-checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid var(--border);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .task-checkbox:hover {
        border-color: var(--primary);
      }

      .task-checkbox.checked {
        background: var(--success);
        border-color: var(--success);
      }

      .task-content {
        flex: 1;
      }

      .task-title {
        font-weight: 600;
        margin-bottom: 4px;
        transition: color 0.2s;
      }

      .task-item:hover .task-title {
        color: var(--primary);
      }

      .task-meta {
        display: flex;
        gap: 12px;
        font-size: 12px;
        color: var(--text-muted);
      }

      .task-assignee {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .task-assignee-avatar {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--gradient-2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 600;
      }

      .task-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .status-pending {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning);
      }
      .status-in-progress {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
      }
      .status-completed {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }

      .task-priority {
        width: 4px;
        height: 40px;
        border-radius: 2px;
      }

      .priority-high {
        background: var(--danger);
      }
      .priority-medium {
        background: var(--warning);
      }
      .priority-low {
        background: var(--success);
      }

      /* Activity Feed */
      .activity-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .activity-item {
        display: flex;
        gap: 12px;
        padding: 16px;
        border-radius: 12px;
        transition: background 0.2s;
      }

      .activity-item:hover {
        background: rgba(255, 255, 255, 0.03);
      }

      .activity-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        flex-shrink: 0;
      }

      .activity-icon.create {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }
      .activity-icon.update {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
      }
      .activity-icon.delete {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }

      .activity-content {
        flex: 1;
      }

      .activity-text {
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 4px;
      }

      .activity-text strong {
        color: var(--text);
        font-weight: 600;
      }

      .activity-time {
        font-size: 12px;
        color: var(--text-muted);
      }

      /* Chatbot Widget */
      .chatbot-widget {
        position: fixed;
        bottom: 24px;
        right: 24px;
        z-index: 1000;
      }

      .chatbot-toggle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--gradient-1);
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: var(--shadow);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .chatbot-toggle:hover {
        transform: scale(1.1);
        box-shadow: var(--glow);
      }

      .chatbot-container {
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 380px;
        height: 500px;
        background: var(--dark);
        border: 1px solid var(--border);
        border-radius: 20px;
        overflow: hidden;
        display: none;
        flex-direction: column;
        box-shadow: var(--shadow);
      }

      .chatbot-container.active {
        display: flex;
        animation: slideUp 0.3s ease;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .chatbot-header {
        padding: 20px;
        background: var(--gradient-1);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .chatbot-avatar {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .chatbot-title {
        flex: 1;
      }

      .chatbot-title h4 {
        font-size: 16px;
        font-weight: 600;
      }

      .chatbot-title p {
        font-size: 12px;
        opacity: 0.9;
      }

      .chatbot-close {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 20px;
        opacity: 0.8;
        transition: opacity 0.2s;
      }

      .chatbot-close:hover {
        opacity: 1;
      }

      .chatbot-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .message {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 16px;
        font-size: 14px;
        line-height: 1.5;
        animation: messageSlide 0.3s ease;
      }

      @keyframes messageSlide {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        align-self: flex-end;
        background: var(--primary);
        color: white;
        border-bottom-right-radius: 4px;
      }

      .message.bot {
        align-self: flex-start;
        background: var(--card);
        border: 1px solid var(--border);
        border-bottom-left-radius: 4px;
      }

      .message-time {
        font-size: 10px;
        opacity: 0.7;
        margin-top: 4px;
      }

      .chatbot-input {
        padding: 16px;
        border-top: 1px solid var(--border);
        display: flex;
        gap: 12px;
      }

      .chatbot-input input {
        flex: 1;
        background: var(--card);
        border: 1px solid var(--border);
        padding: 12px 16px;
        border-radius: 12px;
        color: var(--text);
        outline: none;
        transition: all 0.2s;
      }

      .chatbot-input input:focus {
        border-color: var(--primary);
      }

      .chatbot-send {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        background: var(--primary);
        border: none;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .chatbot-send:hover {
        background: var(--primary-dark);
        transform: scale(1.05);
      }

      .typing-indicator {
        display: none;
        align-self: flex-start;
        background: var(--card);
        padding: 16px;
        border-radius: 16px;
        border-bottom-left-radius: 4px;
      }

      .typing-indicator.active {
        display: flex;
        gap: 4px;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        background: var(--text-muted);
        border-radius: 50%;
        animation: typing 1.4s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
        }
        30% {
          transform: translateY(-10px);
        }
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .modal-overlay.active {
        display: flex;
        opacity: 1;
      }

      .modal {
        background: var(--dark);
        border: 1px solid var(--border);
        border-radius: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow: hidden;
        transform: scale(0.9);
        transition: transform 0.3s;
      }

      .modal-overlay.active .modal {
        transform: scale(1);
      }

      .modal-header {
        padding: 24px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
      }

      .modal-close {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 24px;
        cursor: pointer;
        transition: color 0.2s;
      }

      .modal-close:hover {
        color: var(--text);
      }

      .modal-body {
        padding: 24px;
        overflow-y: auto;
        max-height: 60vh;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
        font-weight: 500;
        color: var(--text-muted);
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        background: var(--card);
        border: 1px solid var(--border);
        padding: 12px 16px;
        border-radius: 12px;
        color: var(--text);
        outline: none;
        transition: all 0.2s;
        font-family: inherit;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }

      .form-textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      /* Auth Pages */
      .auth-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .auth-box {
        width: 100%;
        max-width: 440px;
        padding: 40px;
      }

      .auth-header {
        text-align: center;
        margin-bottom: 32px;
      }

      .auth-header .logo {
        justify-content: center;
        margin-bottom: 24px;
      }

      .auth-header h2 {
        font-size: 28px;
        margin-bottom: 8px;
      }

      .auth-header p {
        color: var(--text-muted);
      }

      .auth-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .input-group {
        position: relative;
      }

      .input-group i {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
      }

      .input-group input {
        width: 100%;
        background: var(--card);
        border: 1px solid var(--border);
        padding: 14px 16px 14px 48px;
        border-radius: 12px;
        color: var(--text);
        outline: none;
        transition: all 0.2s;
      }

      .input-group input:focus {
        border-color: var(--primary);
      }

      .auth-footer {
        text-align: center;
        margin-top: 24px;
        color: var(--text-muted);
        font-size: 14px;
      }

      .auth-footer a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
      }

      .divider {
        display: flex;
        align-items: center;
        gap: 16px;
        margin: 24px 0;
        color: var(--text-muted);
        font-size: 14px;
      }

      .divider::before,
      .divider::after {
        content: "";
        flex: 1;
        height: 1px;
        background: var(--border);
      }

      .google-btn {
        width: 100%;
        background: var(--card);
        border: 1px solid var(--border);
        color: var(--text);
        justify-content: center;
      }

      .alert {
        padding: 12px 16px;
        border-radius: 12px;
        margin-bottom: 20px;
        display: none;
        align-items: center;
        gap: 12px;
        font-size: 14px;
      }

      .alert.active {
        display: flex;
      }

      .alert-error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        color: var(--danger);
      }

      .alert-success {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.2);
        color: var(--success);
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .content-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: 20px;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .chatbot-container {
          width: calc(100vw - 40px);
          right: -20px;
        }
      }

      /* Loading States */
      .skeleton {
        background: linear-gradient(
          90deg,
          var(--card) 25%,
          var(--card-hover) 50%,
          var(--card) 75%
        );
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 8px;
      }

      @keyframes loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* Empty States */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
      }

      .empty-state i {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-state h3 {
        color: var(--text);
        margin-bottom: 8px;
      }

      /* Comments Section */
      .comments-section {
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid var(--border);
      }

      .comment {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
      }

      .comment-content {
        flex: 1;
        background: var(--card);
        padding: 12px 16px;
        border-radius: 12px;
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
      }

      .comment-author {
        font-weight: 600;
        font-size: 14px;
      }

      .comment-time {
        font-size: 12px;
        color: var(--text-muted);
      }

      .comment-text {
        font-size: 14px;
        color: var(--text-muted);
      }

      /* Reports Section */
      .report-card {
        padding: 24px;
        margin-bottom: 24px;
      }

      .chart-container {
        height: 300px;
        margin-top: 20px;
        position: relative;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--card);
        border-radius: 4px;
        overflow: hidden;
        margin-top: 8px;
      }

      .progress-fill {
        height: 100%;
        background: var(--gradient-1);
        border-radius: 4px;
        transition: width 0.5s ease;
      }

      /* Animations */
      .fade-in {
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-animation"></div>

    <!-- Auth Container (shown when not logged in) -->
    <div id="authContainer" class="auth-container" style="display: none">
      <div class="auth-box glass-card">
        <div class="auth-header">
          <div class="logo">
            <i class="fas fa-check-double"></i>
            <span>TaskFlow Pro</span>
          </div>
          <h2 id="authTitle">Welcome Back</h2>
          <p id="authSubtitle">Enter your credentials to access your account</p>
        </div>

        <div id="alertBox" class="alert"></div>

        <form id="authForm" class="auth-form">
          <div id="nameField" class="input-group" style="display: none">
            <i class="fas fa-user"></i>
            <input type="text" id="fullName" placeholder="Full Name" />
          </div>

          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input
              type="email"
              id="email"
              placeholder="Email address"
              required
            />
          </div>

          <div class="input-group">
            <i class="fas fa-lock"></i>
            <input
              type="password"
              id="password"
              placeholder="Password"
              required
            />
          </div>

          <div
            id="confirmPasswordField"
            class="input-group"
            style="display: none"
          >
            <i class="fas fa-lock"></i>
            <input
              type="password"
              id="confirmPassword"
              placeholder="Confirm Password"
            />
          </div>

          <button
            type="submit"
            class="btn btn-primary"
            style="width: 100%; justify-content: center"
          >
            <span id="authButtonText">Sign In</span>
          </button>
        </form>

        <div class="divider">or continue with</div>

        <button id="googleBtn" class="btn btn-secondary google-btn">
          <i class="fab fa-google"></i>
          Google
        </button>

        <div class="auth-footer">
          <p id="authSwitchText">
            Don't have an account? <a href="#" id="authSwitch">Sign up</a>
          </p>
        </div>
      </div>
    </div>

    <!-- Main App Container (shown when logged in) -->
    <div id="appContainer" class="app-container" style="display: block">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <i class="fas fa-check-double"></i>
            <span>TaskFlow Pro</span>
          </div>
        </div>

        <nav class="nav-menu">
          <div class="nav-section">
            <div class="nav-section-title">Main</div>
            <a href="#" class="nav-item active" data-page="dashboard">
              <i class="fas fa-home"></i>
              <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-page="tasks">
              <i class="fas fa-tasks"></i>
              <span>My Tasks</span>
              <span id="taskBadge" class="badge" style="display: none">0</span>
            </a>
            <a
              href="#"
              class="nav-item"
              data-page="activities"
              id="navActivities"
              style="display: none"
            >
              <i class="fas fa-history"></i>
              <span>Activities</span>
            </a>
          </div>

          <div class="nav-section" id="adminSection" style="display: none">
            <div class="nav-section-title">Administration</div>
            <a href="#" class="nav-item" data-page="all-tasks">
              <i class="fas fa-clipboard-list"></i>
              <span>All Tasks</span>
            </a>
            <a href="#" class="nav-item" data-page="users">
              <i class="fas fa-users"></i>
              <span>Users</span>
            </a>
            <a href="#" class="nav-item" data-page="reports">
              <i class="fas fa-chart-bar"></i>
              <span>Reports</span>
            </a>
          </div>
        </nav>

        <div class="sidebar-footer">
          <div class="user-profile" id="userProfile">
            <div class="avatar" id="userAvatar">U</div>
            <div class="user-info">
              <div class="user-name" id="userName">User</div>
              <div class="user-role" id="userRole">Role</div>
            </div>
            <i
              class="fas fa-chevron-right"
              style="color: var(--text-muted); font-size: 12px"
            ></i>
          </div>
          <button
            id="logoutBtn"
            class="btn btn-danger"
            style="width: 100%; margin-top: 12px"
          >
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page fade-in">
          <div class="top-bar">
            <div class="page-title">
              <h1>Dashboard</h1>
              <p>Welcome back! Here's what's happening today.</p>
            </div>
            <div class="top-actions">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search tasks..." />
              </div>
              <button class="btn btn-primary" onclick="openTaskModal()">
                <i class="fas fa-plus"></i>
                New Task
              </button>
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-card glass-card">
              <div class="stat-icon purple">
                <i class="fas fa-tasks"></i>
              </div>
              <div class="stat-value" id="totalTasks">0</div>
              <div class="stat-label">Total Tasks</div>
              <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i> 12% from last week
              </div>
            </div>

            <div class="stat-card glass-card">
              <div class="stat-icon pink">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-value" id="pendingTasks">0</div>
              <div class="stat-label">Pending</div>
              <div class="stat-change negative">
                <i class="fas fa-arrow-down"></i> 3 new today
              </div>
            </div>

            <div class="stat-card glass-card">
              <div class="stat-icon orange">
                <i class="fas fa-spinner"></i>
              </div>
              <div class="stat-value" id="inProgressTasks">0</div>
              <div class="stat-label">In Progress</div>
              <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i> 8 active now
              </div>
            </div>

            <div class="stat-card glass-card">
              <div class="stat-icon green">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="stat-value" id="completedTasks">0</div>
              <div class="stat-label">Completed</div>
              <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i> 24 this month
              </div>
            </div>
          </div>

          <div class="content-grid">
            <div class="recent-tasks">
              <div class="section-header">
                <h3 class="section-title">Recent Tasks</h3>
                <button
                  class="btn btn-secondary btn-sm"
                  onclick="navigateTo('tasks')"
                >
                  View All
                </button>
              </div>
              <div class="task-list" id="recentTasksList">
                <!-- Tasks injected here -->
              </div>
            </div>

            <div class="activity-feed">
              <div class="section-header">
                <h3 class="section-title">Recent Activity</h3>
              </div>
              <div class="activity-list" id="activityList">
                <!-- Activities injected here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Tasks Page -->
        <div id="tasksPage" class="page" style="display: none">
          <div class="top-bar">
            <div class="page-title">
              <h1>My Tasks</h1>
              <p>Manage your assigned tasks</p>
            </div>
            <div class="top-actions">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input
                  type="text"
                  id="taskSearch"
                  placeholder="Filter tasks..."
                />
              </div>
              <select
                id="statusFilter"
                class="form-select"
                style="width: 150px"
              >
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="in-progress">In Progress</option>
                <option value="completed">Completed</option>
              </select>
            </div>
          </div>
          <div class="task-list" id="myTasksList">
            <!-- My tasks injected here -->
          </div>
        </div>

        <!-- All Tasks Page (Admin/Manager only) -->
        <div id="allTasksPage" class="page" style="display: none">
          <div class="top-bar">
            <div class="page-title">
              <h1>All Tasks</h1>
              <p>Manage all team tasks</p>
            </div>
            <div class="top-actions">
              <button class="btn btn-primary" onclick="openTaskModal()">
                <i class="fas fa-plus"></i>
                Create Task
              </button>
            </div>
          </div>
          <div class="glass-card" style="padding: 24px">
            <div style="display: flex; gap: 16px; margin-bottom: 24px">
              <input
                type="text"
                id="allTaskSearch"
                class="form-input"
                placeholder="Search tasks..."
                style="flex: 1"
              />
              <select
                id="allStatusFilter"
                class="form-select"
                style="width: 150px"
              >
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="in-progress">In Progress</option>
                <option value="completed">Completed</option>
              </select>
              <select
                id="priorityFilter"
                class="form-select"
                style="width: 150px"
              >
                <option value="">All Priorities</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div id="allTasksTable">
              <!-- All tasks table injected here -->
            </div>
          </div>
        </div>

        <!-- Users Page (Admin only) -->
        <div id="usersPage" class="page" style="display: none">
          <div class="top-bar">
            <div class="page-title">
              <h1>Team Members</h1>
              <p>Manage users and permissions</p>
            </div>
          </div>
          <div class="glass-card" style="padding: 24px">
            <div id="usersList">
              <!-- Users list injected here -->
            </div>
          </div>
        </div>

        <!-- Reports Page -->
        <div id="reportsPage" class="page" style="display: none">
          <div class="top-bar">
            <div class="page-title">
              <h1>Analytics & Reports</h1>
              <p>Task performance insights</p>
            </div>
            <button class="btn btn-primary" onclick="downloadPDF()">
              <i class="fas fa-download"></i>
              Download PDF
            </button>
          </div>

          <div class="report-card glass-card">
            <h3 class="section-title">Tasks per User</h3>
            <div id="tasksPerUserChart" class="chart-container">
              <!-- Chart injected here -->
            </div>
          </div>

          <div class="report-card glass-card">
            <h3 class="section-title">Tasks by Status</h3>
            <div id="tasksPerStatusChart" class="chart-container">
              <!-- Chart injected here -->
            </div>
          </div>
        </div>

        <!-- Activities Page -->
        <div id="activitiesPage" class="page" style="display: none">
          <div class="top-bar">
            <div class="page-title">
              <h1>Activity Log</h1>
              <p>Track all system activities</p>
            </div>
          </div>
          <div class="glass-card" style="padding: 24px">
            <div id="activitiesList">
              <!-- Activities injected here -->
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Chatbot Widget -->
    <div class="chatbot-widget">
      <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
          <div class="chatbot-avatar">
            <i class="fas fa-robot"></i>
          </div>
          <div class="chatbot-title">
            <h4>Task Assistant</h4>
            <p>Ask me about your tasks</p>
          </div>
          <button class="chatbot-close" onclick="toggleChatbot()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="chatbot-messages" id="chatMessages">
          <div class="message bot">
            Hello! I'm your Task Assistant. I can help you with:
            <br />• "How many pending tasks?" <br />• "Who is assigned to task
            12?" <br />• "List completed tasks"
            <div class="message-time">Just now</div>
          </div>
        </div>
        <div class="typing-indicator" id="typingIndicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
        <div class="chatbot-input">
          <input
            type="text"
            id="chatInput"
            placeholder="Ask about tasks..."
            onkeypress="handleChatKeypress(event)"
          />
          <button class="chatbot-send" onclick="sendMessage()">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
      <button class="chatbot-toggle" onclick="toggleChatbot()">
        <i class="fas fa-comment-dots"></i>
      </button>
    </div>

    <!-- Task Modal -->
    <div class="modal-overlay" id="taskModal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title" id="modalTitle">Create New Task</h3>
          <button class="modal-close" onclick="closeTaskModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form id="taskForm">
            <div class="form-group">
              <label class="form-label">Task Title</label>
              <input
                type="text"
                class="form-input"
                id="taskTitle"
                required
                placeholder="Enter task title"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Description</label>
              <textarea
                class="form-textarea"
                id="taskDescription"
                placeholder="Add details..."
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Priority</label>
                <select class="form-select" id="taskPriority">
                  <option value="low">Low</option>
                  <option value="medium" selected>Medium</option>
                  <option value="high">High</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-select" id="taskStatus">
                  <option value="pending" selected>Pending</option>
                  <option value="in-progress">In Progress</option>
                  <option value="completed">Completed</option>
                </select>
              </div>
            </div>

            <div class="form-group" id="assigneeGroup">
              <label class="form-label">Assign To</label>
              <select class="form-select" id="taskAssignee">
                <option value="">Select User</option>
              </select>
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%; margin-top: 8px"
            >
              Create Task
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal-overlay" id="taskDetailModal">
      <div class="modal" style="max-width: 700px">
        <div class="modal-header">
          <h3 class="modal-title" id="detailTaskTitle">Task Details</h3>
          <button class="modal-close" onclick="closeTaskDetailModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="taskDetailContent">
            <!-- Task details injected here -->
          </div>

          <div class="comments-section">
            <h4 style="margin-bottom: 16px">Comments</h4>
            <div id="commentsList">
              <!-- Comments injected here -->
            </div>
            <div style="display: flex; gap: 12px; margin-top: 16px">
              <input
                type="text"
                id="commentInput"
                class="form-input"
                placeholder="Add a comment..."
              />
              <button class="btn btn-primary" onclick="addComment()">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // API Configuration
      const API_BASE_URL = "http://localhost:8000";
      let currentUser = null;
      let authToken = localStorage.getItem("token");
      let currentPage = "dashboard";
      let tasksData = [];
      let usersData = [];

      // Initialize App
      document.addEventListener("DOMContentLoaded", () => {
        if (authToken) {
          validateToken();
        } else {
          showAuth();
        }

        setupEventListeners();
      });

      // Auth Functions
      function showAuth() {
        document.getElementById("authContainer").style.display = "flex";
        document.getElementById("appContainer").style.display = "flex";
      }

      function showApp() {
        document.getElementById("authContainer").style.display = "none";
        document.getElementById("appContainer").style.display = "flex";
        initializeDashboard();
      }

      async function validateToken() {
        try {
          const response = await fetch(`${API_BASE_URL}/auth/user_id/me`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            currentUser = await response.json();
            showApp();
          } else {
            localStorage.removeItem("token");
            showAuth();
          }
        } catch (error) {
          showAuth();
        }
      }

      function setupEventListeners() {
        // Auth form
        document
          .getElementById("authForm")
          .addEventListener("submit", handleAuth);
        document
          .getElementById("authSwitch")
          .addEventListener("click", toggleAuthMode);
        document
          .getElementById("googleBtn")
          .addEventListener("click", handleGoogleAuth);

        // Logout
        document.getElementById("logoutBtn").addEventListener("click", logout);

        // Navigation
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.addEventListener("click", (e) => {
            e.preventDefault();
            const page = item.getAttribute("data-page");
            if (page) navigateTo(page);
          });
        });

        // Task form
        document
          .getElementById("taskForm")
          .addEventListener("submit", handleTaskSubmit);

        // Filters
        document
          .getElementById("statusFilter")
          ?.addEventListener("change", filterTasks);
        document
          .getElementById("taskSearch")
          ?.addEventListener("input", filterTasks);
      }

      let isLoginMode = true;

      function toggleAuthMode(e) {
        e.preventDefault();
        isLoginMode = !isLoginMode;

        document.getElementById("authTitle").textContent = isLoginMode
          ? "Welcome Back"
          : "Create Account";
        document.getElementById("authSubtitle").textContent = isLoginMode
          ? "Enter your credentials to access your account"
          : "Start your journey with us";
        document.getElementById("authButtonText").textContent = isLoginMode
          ? "Sign In"
          : "Sign Up";
        document.getElementById("authSwitchText").innerHTML = isLoginMode
          ? 'Don\'t have an account? <a href="#" id="authSwitch">Sign up</a>'
          : 'Already have an account? <a href="#" id="authSwitch">Sign in</a>';
        document.getElementById("nameField").style.display = isLoginMode
          ? "none"
          : "block";
        document.getElementById("confirmPasswordField").style.display =
          isLoginMode ? "none" : "block";

        document
          .getElementById("authSwitch")
          .addEventListener("click", toggleAuthMode);
      }

      async function handleAuth(e) {
        e.preventDefault();

        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        if (!isLoginMode) {
          const name = document.getElementById("fullName").value;
          const confirmPass = document.getElementById("confirmPassword").value;

          if (password !== confirmPass) {
            showAlert("Passwords do not match", "error");
            return;
          }

          // Signup
          try {
            const response = await fetch(`${API_BASE_URL}/auth/signup`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                email,
                password,
                username: name,
                role: "user",
              }),
            });

            if (response.ok) {
              showAlert(
                "Account created! Please check your email to verify.",
                "success",
              );
              toggleAuthMode({ preventDefault: () => {} });
            } else {
              const error = await response.json();
              showAlert(error.detail || "Signup failed", "error");
            }
          } catch (error) {
            showAlert("Network error", "error");
          }
        } else {
          // Login
          try {
            const response = await fetch(`${API_BASE_URL}/auth/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, password }),
            });

            if (response.ok) {
              const data = await response.json();
              authToken = data.access_token;
              localStorage.setItem("token", authToken);
              currentUser = data.user;
              showApp();
            } else {
              const error = await response.json();
              showAlert(error.detail || "Login failed", "error");
            }
          } catch (error) {
            showAlert("Network error", "error");
          }
        }
      }

      function handleGoogleAuth() {
        // Implement Google OAuth
        showAlert("Google OAuth coming soon", "error");
      }

      function logout() {
        localStorage.removeItem("token");
        authToken = null;
        currentUser = null;
        showAuth();
      }

      function showAlert(message, type) {
        const alertBox = document.getElementById("alertBox");
        alertBox.textContent = message;
        alertBox.className = `alert alert-${type} active`;
        setTimeout(() => alertBox.classList.remove("active"), 5000);
      }

      // Navigation
      function navigateTo(page) {
        // Hide all pages
        document
          .querySelectorAll(".page")
          .forEach((p) => (p.style.display = "none"));

        // Update nav
        document
          .querySelectorAll(".nav-item")
          .forEach((item) => item.classList.remove("active"));
        document
          .querySelector(`[data-page="${page}"]`)
          ?.classList.add("active");

        // Show page
        const pageMap = {
          dashboard: "dashboardPage",
          tasks: "tasksPage",
          "all-tasks": "allTasksPage",
          users: "usersPage",
          reports: "reportsPage",
          activities: "activitiesPage",
        };

        const pageId = pageMap[page];
        if (pageId) {
          document.getElementById(pageId).style.display = "block";
          currentPage = page;

          // Load page data
          if (page === "tasks") loadMyTasks();
          if (page === "all-tasks") loadAllTasks();
          if (page === "users") loadUsers();
          if (page === "reports") loadReports();
          if (page === "activities") loadActivities();
        }
      }

      // Dashboard Initialization
      async function initializeDashboard() {
        // Update user info
        document.getElementById("userName").textContent = currentUser.username;
        document.getElementById("userRole").textContent = currentUser.role;
        document.getElementById("userAvatar").textContent = currentUser.username
          .charAt(0)
          .toUpperCase();

        // Show/hide admin sections
        if (currentUser.role === "admin" || currentUser.role === "manager") {
          document.getElementById("adminSection").style.display = "block";
          document.getElementById("navActivities").style.display = "flex";
        }

        // Load stats
        await loadDashboardStats();
        await loadRecentTasks();
        await loadRecentActivities();
      }

      async function loadDashboardStats() {
        try {
          // Get all tasks for stats
          const endpoint =
            currentUser.role === "admin" || currentUser.role === "manager"
              ? "/tasks/"
              : "/tasks/my";

          const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            tasksData = await response.json();

            const pending = tasksData.filter(
              (t) => t.status === "pending",
            ).length;
            const inProgress = tasksData.filter(
              (t) => t.status === "in-progress",
            ).length;
            const completed = tasksData.filter(
              (t) => t.status === "completed",
            ).length;

            document.getElementById("totalTasks").textContent =
              tasksData.length;
            document.getElementById("pendingTasks").textContent = pending;
            document.getElementById("inProgressTasks").textContent = inProgress;
            document.getElementById("completedTasks").textContent = completed;

            // Update badge
            const myPending = tasksData.filter(
              (t) =>
                t.status === "pending" && t.assigned_to_id === currentUser.id,
            ).length;
            if (myPending > 0) {
              document.getElementById("taskBadge").textContent = myPending;
              document.getElementById("taskBadge").style.display = "block";
            }
          }
        } catch (error) {
          console.error("Failed to load stats:", error);
        }
      }

      async function loadRecentTasks() {
        const container = document.getElementById("recentTasksList");
        container.innerHTML = "";

        try {
          const endpoint =
            currentUser.role === "admin" || currentUser.role === "manager"
              ? "/tasks/"
              : "/tasks/my";

          const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const tasks = await response.json();
            const recentTasks = tasks.slice(0, 5);

            recentTasks.forEach((task) => {
              container.appendChild(createTaskElement(task));
            });
          }
        } catch (error) {
          container.innerHTML =
            '<div class="empty-state"><i class="fas fa-inbox"></i><h3>No tasks found</h3></div>';
        }
      }

      function createTaskElement(task) {
        const div = document.createElement("div");
        div.className = "task-item glass-card";
        div.onclick = () => openTaskDetail(task.id);

        const priorityClass =
          task.priority === "high"
            ? "priority-high"
            : task.priority === "medium"
              ? "priority-medium"
              : "priority-low";
        const statusClass = `status-${task.status}`;

        div.innerHTML = `
                      <div class="task-priority ${priorityClass}"></div>
                      <div class="task-checkbox ${task.status === "completed" ? "checked" : ""}" onclick="event.stopPropagation(); toggleTaskStatus(${task.id})">
                          ${task.status === "completed" ? '<i class="fas fa-check" style="font-size: 12px; color: white;"></i>' : ""}
                      </div>
                      <div class="task-content">
                          <div class="task-title">${task.title}</div>
                          <div class="task-meta">
                              <span class="task-status ${statusClass}">${task.status.replace("-", " ")}</span>
                              <span><i class="fas fa-flag" style="color: var(--text-muted);"></i> ${task.priority}</span>
                          </div>
                      </div>
                      <div class="task-assignee">
                          <div class="task-assignee-avatar">${task.assigned_to ? task.assigned_to.charAt(0).toUpperCase() : "?"}</div>
                      </div>
                  `;

        return div;
      }

      async function loadRecentActivities() {
        const container = document.getElementById("activityList");
        container.innerHTML = "";

        try {
          let endpoint;
          if (currentUser.role === "admin") {
            endpoint = "/activities/";
          } else if (currentUser.role === "manager") {
            // Managers might have limited access
            endpoint = "/activities/";
          } else {
            endpoint = `/activities/user/${currentUser.id}`;
          }

          const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const activities = await response.json();
            const recentActivities = activities.slice(0, 5);

            recentActivities.forEach((activity) => {
              container.appendChild(createActivityElement(activity));
            });
          }
        } catch (error) {
          container.innerHTML =
            '<div class="empty-state"><i class="fas fa-history"></i><h3>No recent activity</h3></div>';
        }
      }

      function createActivityElement(activity) {
        const div = document.createElement("div");
        div.className = "activity-item";

        let iconClass = "update";
        let icon = "fa-edit";

        if (activity.action.includes("create")) {
          iconClass = "create";
          icon = "fa-plus";
        } else if (activity.action.includes("delete")) {
          iconClass = "delete";
          icon = "fa-trash";
        }

        div.innerHTML = `
                      <div class="activity-icon ${iconClass}">
                          <i class="fas ${icon}"></i>
                      </div>
                      <div class="activity-content">
                          <div class="activity-text">
                              <strong>${activity.user_username || "System"}</strong> ${activity.action} task <strong>#${activity.task_id}</strong>
                          </div>
                          <div class="activity-time">${formatTime(activity.timestamp)}</div>
                      </div>
                  `;

        return div;
      }

      // Task Management
      async function loadMyTasks() {
        const container = document.getElementById("myTasksList");
        container.innerHTML =
          '<div class="skeleton" style="height: 80px; margin-bottom: 12px;"></div>'.repeat(
            3,
          );

        try {
          const response = await fetch(`${API_BASE_URL}/tasks/my`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            tasksData = await response.json();
            renderTasks(tasksData);
          }
        } catch (error) {
          container.innerHTML =
            '<div class="empty-state"><i class="fas fa-exclamation-circle"></i><h3>Failed to load tasks</h3></div>';
        }
      }

      function renderTaskDetail(task) {
        const container = document.getElementById("taskDetailContent");
        document.getElementById("detailTaskTitle").textContent = task.title;

        const canEdit =
          currentUser.role === "admin" ||
          currentUser.role === "manager" ||
          task.assigned_to_id === currentUser.id;

        container.innerHTML = `
                <div style="margin-bottom: 24px;">
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <span class="task-status status-${task.status}">${task.status.replace("-", " ")}</span>
                        <span style="padding: 4px 12px; background: var(--card); border-radius: 20px; font-size: 12px; text-transform: uppercase; font-weight: 600;">
                            ${task.priority} Priority
                        </span>
                    </div>
                    
                    <p style="color: var(--text-muted); line-height: 1.6; margin-bottom: 16px;">
                        ${task.description || "No description provided."}
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div class="glass-card" style="padding: 16px;">
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Assigned To</div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="task-assignee-avatar">${task.assigned_to ? task.assigned_to.charAt(0).toUpperCase() : "?"}</div>
                                <span style="font-weight: 600;">${task.assigned_to || "Unassigned"}</span>
                            </div>
                        </div>
                        
                        <div class="glass-card" style="padding: 16px;">
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Created</div>
                            <div style="font-weight: 600;">${formatDate(task.created_at)}</div>
                        </div>
                    </div>
                    
                    ${
                      canEdit
                        ? `
                    <div style="display: flex; gap: 12px;">
                        <select id="detailStatusSelect" class="form-select" style="width: auto;" onchange="updateTaskStatus(${task.id}, this.value)">
                            <option value="pending" ${task.status === "pending" ? "selected" : ""}>Pending</option>
                            <option value="in-progress" ${task.status === "in-progress" ? "selected" : ""}>In Progress</option>
                            <option value="completed" ${task.status === "completed" ? "selected" : ""}>Completed</option>
                        </select>
                        
                        ${
                          currentUser.role === "admin" ||
                          currentUser.role === "manager"
                            ? `
                        <button class="btn btn-danger" onclick="deleteTask(${task.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        `
                            : ""
                        }
                    </div>
                    `
                        : ""
                    }
                </div>
            `;
      }

      async function loadComments(taskId) {
        const container = document.getElementById("commentsList");
        container.innerHTML =
          '<div class="skeleton" style="height: 60px; margin-bottom: 12px;"></div>'.repeat(
            2,
          );

        try {
          const response = await fetch(
            `${API_BASE_URL}/tasks/${taskId}/comments/`,
            {
              headers: { Authorization: `Bearer ${authToken}` },
            },
          );

          if (response.ok) {
            const comments = await response.json();
            container.innerHTML = "";

            if (comments.length === 0) {
              container.innerHTML =
                '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No comments yet</div>';
              return;
            }

            comments.forEach((comment) => {
              container.appendChild(createCommentElement(comment));
            });
          }
        } catch (error) {
          container.innerHTML =
            '<div style="color: var(--danger);">Failed to load comments</div>';
        }
      }

      function createCommentElement(comment) {
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `
                <div class="task-assignee-avatar">${comment.user_username ? comment.user_username.charAt(0).toUpperCase() : "?"}</div>
                <div class="comment-content">
                    <div class="comment-header">
                        <span class="comment-author">${comment.user_username || "Unknown"}</span>
                        <span class="comment-time">${formatTime(comment.created_at)}</span>
                    </div>
                    <div class="comment-text">${comment.content}</div>
                </div>
            `;
        return div;
      }

      async function addComment() {
        const input = document.getElementById("commentInput");
        const content = input.value.trim();

        if (!content || !currentTaskId) return;

        try {
          const response = await fetch(
            `${API_BASE_URL}/tasks/${currentTaskId}/comments/`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${authToken}`,
              },
              body: JSON.stringify({ content }),
            },
          );

          if (response.ok) {
            input.value = "";
            loadComments(currentTaskId);
          }
        } catch (error) {
          alert("Failed to add comment");
        }
      }

      function closeTaskDetailModal() {
        document.getElementById("taskDetailModal").classList.remove("active");
        currentTaskId = null;
      }

      async function updateTaskStatus(taskId, status) {
        try {
          const response = await fetch(
            `${API_BASE_URL}/tasks/${taskId}/status`,
            {
              method: "PATCH",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${authToken}`,
              },
              body: JSON.stringify({ status }),
            },
          );

          if (response.ok) {
            loadDashboardStats();
            if (currentPage === "tasks") loadMyTasks();
            if (currentPage === "all-tasks") loadAllTasks();
          }
        } catch (error) {
          alert("Failed to update status");
        }
      }

      async function toggleTaskStatus(taskId) {
        const task = tasksData.find((t) => t.id === taskId);
        if (!task) return;

        const newStatus = task.status === "completed" ? "pending" : "completed";
        await updateTaskStatus(taskId, newStatus);
      }

      async function deleteTask(taskId) {
        if (!confirm("Are you sure you want to delete this task?")) return;

        try {
          const response = await fetch(`${API_BASE_URL}/tasks/${taskId}`, {
            method: "DELETE",
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            closeTaskDetailModal();
            loadDashboardStats();
            if (currentPage === "all-tasks") loadAllTasks();
          }
        } catch (error) {
          alert("Failed to delete task");
        }
      }

      // User Management
      async function loadUsers() {
        const container = document.getElementById("usersList");
        container.innerHTML =
          '<div class="skeleton" style="height: 60px; margin-bottom: 12px;"></div>'.repeat(
            3,
          );

        try {
          const response = await fetch(`${API_BASE_URL}/auth/`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const users = await response.json();
            renderUsers(users);
          }
        } catch (error) {
          container.innerHTML =
            '<div class="empty-state">Failed to load users</div>';
        }
      }

      function renderUsers(users) {
        const container = document.getElementById("usersList");

        let html = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid var(--border);">
                            <th style="padding: 12px; color: var(--text-muted); font-weight: 500;">User</th>
                            <th style="padding: 12px; color: var(--text-muted); font-weight: 500;">Role</th>
                            <th style="padding: 12px; color: var(--text-muted); font-weight: 500;">Status</th>
                            <th style="padding: 12px; color: var(--text-muted); font-weight: 500;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        users.forEach((user) => {
          html += `
                    <tr style="border-bottom: 1px solid var(--border);">
                        <td style="padding: 16px 12px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="avatar">${user.username.charAt(0).toUpperCase()}</div>
                                <div>
                                    <div style="font-weight: 600;">${user.username}</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">${user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 16px 12px;">
                            <select class="form-select" style="width: 120px;" onchange="changeUserRole(${user.id}, this.value)" ${user.id === currentUser.id ? "disabled" : ""}>
                                <option value="user" ${user.role === "user" ? "selected" : ""}>User</option>
                                <option value="manager" ${user.role === "manager" ? "selected" : ""}>Manager</option>
                                <option value="admin" ${user.role === "admin" ? "selected" : ""}>Admin</option>
                            </select>
                        </td>
                        <td style="padding: 16px 12px;">
                            <span style="display: flex; align-items: center; gap: 6px;">
                                <span style="width: 8px; height: 8px; background: ${user.is_active ? "var(--success)" : "var(--danger)"}; border-radius: 50%;"></span>
                                ${user.is_active ? "Active" : "Inactive"}
                            </span>
                        </td>
                        <td style="padding: 16px 12px;">
                            <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})" ${user.id === currentUser.id ? "disabled" : ""}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
        });

        html += "</tbody></table>";
        container.innerHTML = html;
      }

      async function changeUserRole(userId, newRole) {
        try {
          const response = await fetch(`${API_BASE_URL}/auth/${userId}/role`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({ role: newRole }),
          });

          if (!response.ok) {
            alert("Failed to update role");
            loadUsers();
          }
        } catch (error) {
          alert("Network error");
          loadUsers();
        }
      }

      async function deleteUser(userId) {
        if (!confirm("Are you sure you want to delete this user?")) return;

        try {
          const response = await fetch(
            `${API_BASE_URL}/auth/user_id/${userId}`,
            {
              method: "DELETE",
              headers: { Authorization: `Bearer ${authToken}` },
            },
          );

          if (response.ok) {
            loadUsers();
          }
        } catch (error) {
          alert("Failed to delete user");
        }
      }

      // Reports
      async function loadReports() {
        try {
          const userResponse = await fetch(
            `${API_BASE_URL}/reports/tasks-per-user`,
            {
              headers: { Authorization: `Bearer ${authToken}` },
            },
          );

          if (userResponse.ok) {
            const data = await userResponse.json();
            renderTasksPerUserChart(data);
          }

          const statusResponse = await fetch(
            `${API_BASE_URL}/reports/tasks-per-status`,
            {
              headers: { Authorization: `Bearer ${authToken}` },
            },
          );

          if (statusResponse.ok) {
            const data = await statusResponse.json();
            renderTasksPerStatusChart(data);
          }
        } catch (error) {
          console.error("Failed to load reports:", error);
        }
      }

      function renderTasksPerUserChart(data) {
        const container = document.getElementById("tasksPerUserChart");
        if (!data || data.length === 0) {
          container.innerHTML =
            '<div class="empty-state">No data available</div>';
          return;
        }

        let maxTasks = Math.max(...data.map((d) => d.task_count || 0));
        if (maxTasks === 0) maxTasks = 1;

        let html =
          '<div style="display: flex; flex-direction: column; gap: 16px;">';

        data.forEach((item) => {
          const percentage = ((item.task_count || 0) / maxTasks) * 100;
          html += `
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 500;">${item.username || "Unknown"}</span>
                            <span style="color: var(--text-muted);">${item.task_count || 0} tasks</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%;"></div>
                        </div>
                    </div>
                `;
        });

        html += "</div>";
        container.innerHTML = html;
      }

      function renderTasksPerStatusChart(data) {
        const container = document.getElementById("tasksPerStatusChart");
        if (!data || data.length === 0) {
          container.innerHTML =
            '<div class="empty-state">No data available</div>';
          return;
        }

        const total = data.reduce((sum, item) => sum + (item.count || 0), 0);
        if (total === 0) {
          container.innerHTML = '<div class="empty-state">No tasks found</div>';
          return;
        }

        let html =
          '<div style="display: flex; flex-direction: column; gap: 20px;">';

        const colors = {
          pending: "var(--warning)",
          "in-progress": "var(--primary)",
          completed: "var(--success)",
        };

        data.forEach((item) => {
          const count = item.count || 0;
          const percentage = ((count / total) * 100).toFixed(1);
          const color = colors[item.status] || "var(--text-muted)";
          const statusLabel = item.status
            ? item.status.replace("-", " ")
            : "Unknown";

          html += `
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <div style="width: 120px; font-weight: 500; text-transform: capitalize;">${statusLabel}</div>
                        <div style="flex: 1;">
                            <div class="progress-bar" style="background: rgba(255,255,255,0.1);">
                                <div style="width: ${percentage}%; height: 100%; background: ${color}; border-radius: 4px; transition: width 0.5s ease;"></div>
                            </div>
                        </div>
                        <div style="width: 60px; text-align: right; font-weight: 600;">${percentage}%</div>
                        <div style="width: 40px; text-align: right; color: var(--text-muted);">${count}</div>
                    </div>
                `;
        });

        html += "</div>";
        container.innerHTML = html;
      }

      async function downloadPDF() {
        try {
          const response = await fetch(`${API_BASE_URL}/reports/pdf`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "task_report.pdf";
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
          } else {
            alert("Failed to download PDF");
          }
        } catch (error) {
          alert("Network error while downloading PDF");
        }
      }

      // Activities
      async function loadActivities() {
        const container = document.getElementById("activitiesList");
        container.innerHTML =
          '<div class="skeleton" style="height: 60px; margin-bottom: 12px;"></div>'.repeat(
            5,
          );

        try {
          const response = await fetch(`${API_BASE_URL}/activities/`, {
            headers: { Authorization: `Bearer ${authToken}` },
          });

          if (response.ok) {
            const activities = await response.json();
            container.innerHTML = "";

            if (activities.length === 0) {
              container.innerHTML =
                '<div class="empty-state"><i class="fas fa-history"></i><h3>No activities found</h3></div>';
              return;
            }

            activities.forEach((activity) => {
              container.appendChild(createActivityElement(activity));
            });
          }
        } catch (error) {
          container.innerHTML =
            '<div class="empty-state">Failed to load activities</div>';
        }
      }

      // Chatbot Functions
      function toggleChatbot() {
        document.getElementById("chatbotContainer").classList.toggle("active");
      }

      function handleChatKeypress(e) {
        if (e.key === "Enter") sendMessage();
      }

      async function sendMessage() {
        const input = document.getElementById("chatInput");
        const message = input.value.trim();

        if (!message) return;

        addChatMessage(message, "user");
        input.value = "";

        document.getElementById("typingIndicator").classList.add("active");

        try {
          const response = await fetch(`${API_BASE_URL}/chat`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({ query: message }),
          });

          document.getElementById("typingIndicator").classList.remove("active");

          if (response.ok) {
            const data = await response.json();
            addChatMessage(data.response, "bot");
          } else {
            addChatMessage("I don't have enough data.", "bot");
          }
        } catch (error) {
          document.getElementById("typingIndicator").classList.remove("active");
          addChatMessage(
            "I'm having trouble connecting. Please try again.",
            "bot",
          );
        }
      }

      function addChatMessage(text, sender) {
        const container = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${sender}`;

        const time = new Date().toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });

        messageDiv.innerHTML = `
                ${escapeHtml(text)}
                <div class="message-time">${time}</div>
            `;

        container.appendChild(messageDiv);
        container.scrollTop = container.scrollHeight;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Utility Functions
      function formatTime(timestamp) {
        if (!timestamp) return "";
        const date = new Date(timestamp);
        const now = new Date();
        const diff = now - date;

        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return "Just now";
        if (minutes < 60) return `${minutes}m ago`;
        if (hours < 24) return `${hours}h ago`;
        if (days < 7) return `${days}d ago`;

        return date.toLocaleDateString();
      }

      function formatDate(timestamp) {
        if (!timestamp) return "";
        return new Date(timestamp).toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      // Close modals on outside click
      document.querySelectorAll(".modal-overlay").forEach((overlay) => {
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) {
            overlay.classList.remove("active");
          }
        });
      });

      // Handle escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          document
            .querySelectorAll(".modal-overlay.active")
            .forEach((modal) => {
              modal.classList.remove("active");
            });
        }
      });
    </script>
  </body>
</html>
